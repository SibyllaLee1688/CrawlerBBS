
# -*- coding: utf-8 -*-
import urllib2
import re
import sys
from save_into_db import *
from sgmllib import SGMLParser
from parser import bbs_parser
# spider engine to get all the link of a target link
Dic = {}





bbs_db = bbsDB()
bbs_db.link_db()
post_db = Post()
poster_db = Poster()
pp_relate = post_poster_relation()
st = get_post("http://bbs.whu.edu.cn/wForum/disparticle.php?boardName=WHUConnection&ID=72239")
print len(st)
sts = MySQLdb.connect(host = 'localhost',user='root',passwd='19910101',db='bbs_db')
cursor = sts.cursor()
bbs_db.select_dbs('bbs_db')
for item in st:
    post_db.set_value(item[0],item[5],item[2],item[4])
    post_db.insert_value(bbs_db.cursor)
    bbs_db.conn.commit()
    poster_db.set_value(item[0],item[1])
    poster_db.insert_value(bbs_db.cursor)
    bbs_db.conn.commit()
    
    poster_id = poster_db.get_id(item[0],bbs_db.cursor)
    post_id = post_db.get_id(item[0],item[5],bbs_db.cursor)
    print poster_id,post_id
    bbs_db.conn.commit()
    pp_relate.set_value(post_id,poster_id,item[3])
    pp_relate.insert_value(bbs_db.cursor)
    bbs_db.conn.commit()
bbs_db.conn.close()    
